<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="Keywords"
      content="YouTube, YouTube Looks Better, Live stream, streaming, livestream"
    />
    <meta
      name="description"
      content="Convenient viewing of live broadcasts on YouTube."
    />
    <title>YouTube Looks Better</title>
    <link rel="stylesheet" href="styleWatch.css" />
    <!--      -->
    <link rel="stylesheet" href="//cdn.materialdesignicons.com/5.4.55/css/materialdesignicons.min.css">
    <link
    rel="stylesheet"
    href="odometer-theme-default.css"
  />
    <!--  -->
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <!--  -->
    <script src="watch.js"></script>
    <script src="odometer.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  </head>

  <body>
    <div class="top">
      <script>
        var isResizing = false,
          lastDownX = 0;

        $(function () {
          var container = $("#container"),
            left = $("#left_panel"),
            right = $("#right_panel"),
            handle = $("#drag");

          handle.on("mousedown", function (e) {
            isResizing = true;
            lastDownX = e.clientX;
          });

          $(document)
            .on("mousemove", function (e) {
              // we don't want to do anything if we aren't resizing.
              if (!isResizing) return;

              var offsetRight =
                container.width() - (e.clientX - container.offset().left);

              left.css("right", offsetRight);
              right.css("width", offsetRight);
            })
            .on("mouseup", function (e) {
              // stop resizing
              isResizing = false;
            })
            .on("dblclick", function (e) {
              left.css("right", 300);
              right.css("width", 300);
              isResizing = false;
            });
        });
        // Control Volume
        function updateTextInput(val) {
          document.getElementById("textInput").textContent = val;
        }
      </script>
      <div id="container">
        <!-- Back -->
        <input class="homepage" title="Back" type="button" onclick="location.href='/';"/>
        <!-- Back to YouTube -->
        <input class="back2youtube" title="Back to YouTube" type="button" onclick="location.href='https://youtube.com';"/>
        <!--  -->
        <div id="left_panel">
          <!-- Start Video -->
          <div class="video">
            <!-- Range-Volume -->
            <div class="ControlBtns">
              <input
                id="YouTube-player-volume"
                class="YouTube-volume-input mdl-slider mdl-js-slider"
                type="range"
                min="0"
                max="100"
                title="Volume"
                oninput="youTubePlayerVolumeChange(this.value);updateTextInput(this.value);"
              />
              <span type="text" id="textInput">Vol</span>
            </div>
            <!--  -->
            <div id="ytplayer"></div>
            <!--  -->
          </div>
        </div>
        <!-- End Video -->
      </div>
      <div id="right_panel">
        <!-- Start Chat -->
        <div
          title="
Left mouse btn and drag (Mouse Wheels) — resizing.
Double Click — position by default.
        "
          id="drag"
        ></div>
        <div class="chat">
          <script>
            const chat =
              "https://www.youtube.com/live_chat?v=" +
              VIDEO_ID +
              "&embed_domain=" +
              window.location.hostname;
            //
            document.write(
              " <iframe id='ytchat' name='frame' src='" +
                chat +
                "'frameborder='0' ></iframe>"
            );
          </script>
        </div>
        <!-- End Chat -->
      </div>
      <!-- hideChatBtn -->
      <button
        onclick="hideChatBtn()"
        class="hideChatBtn"
        title="Hide Chat"
      ></button>
      <!-- Popup chat -->
      <button
        onclick="popupChat()"
        class="PopupChatBtn"
        title="Popup Chat"
      ></button>
    </div>

    <!--  -->

    <div class="VideoInfo">
      <!-- <img id="YTthnail" /> -->

      <div class="title">
        <p class="mdi mdi-text"></p>
        <div id="title">Loading...</div>
      </div>

      <div class="baseInfo">

        <div class="percent">
          <div class="lf">
            <div class="like" title="Лайков">
              <p class="mdi mdi-thumb-up"></p>
              <div id="likesCount" class="odometer">Loading...</div>
            </div>
            <div class="disLike" title="Дизлайков">
              <p class="mdi mdi-thumb-down"></p>
              <div id="dislikeCount" class="odometer">Loading...</div>
            </div>
          </div>
          <!--  -->
        <progress max="100" id="likeProgress" title="Процент лайков"></progress>
        <!--  -->
        </div>

          <div class="viewers" title="Сейчас смотрят">
            <p class="mdi mdi-account" style="font-size: 39px"></p>
            <div id="viewersCount" class="odometer">Loading...</div>
          </div>
  
          <div class="views" title="Просмотров на видео с момента публикации">
            <p class="mdi mdi-account-multiple"></p>
            <div id="viewCount" class="odometer">Loading...</div>
          </div>

      </div>
      <!--  -->
      <div class="flx">
      <div class="CHinfo">
          <img id="CHavatar"></img>
          <!-- IconFlx -->
          <div class="iconFLX">
            <div id="CHchannelName">Loading...</div>

            <div class="flxText">
              <div class="CHicon" title="Количество подписчиков">
                <p class="mdi mdi-youtube-subscription"></p>
              <div id="CHsubscribersCountAPI" class="odometer">Loading...</div>
              </div>
              <div class="CHicon" title="Количество загруженных видео">
              <p class="mdi mdi-upload"></p>
              <div id="CHvideoCount" class="odometer">Loading...</div>
              </div>
              <div class="CHicon" title="Количество просмотров на всех видео">
              <p class="mdi mdi-eye"></p>
              <div id="CHviewCount" class="odometer">Loading...</div>
              </div>
            </div>
          </div>
          <!--  -->
        </div>
        <div class="StartTime">
          <h4 class="mTB-5">Трансляция запланирована</h4>
          <div class="timeIcon">
            <p class="mdi mdi-clock"></p>
            <div id="scheduledStartTime">Loading...</div>
          </div>
          <h4 class="mTB-5">Трансляция началась</h4>
          <div class="timeIcon">
            <p class="mdi mdi-clock"></p>
            <div id="actualStartTime">Loading...</div>
          </div>
          <h4 class="mTB-5">Видео опубликовано</h4>
          <div class="timeIcon">
          <p class="mdi mdi-clock"></p>
          <div id="publishedAt">Loading...</div>
          </div>
        </div>
      </div>
      <!--  -->
      <div id="description">Loading...</div>
      <div class="footer">
        &copy; 8 Feb 2021 — <span id="copyright">
            <script>document.getElementById('copyright').appendChild(document.createTextNode(new Date().getFullYear()))</script>
        </span><a style="color: gray;" href="https://ylbetter.github.io" target="_blank"> YLBetter</a>
    </div>

    </div>
    <script>
      var countlength, likes, views, viewsA;
      var param = window.location.search.split("?v=");
      var video_id = param[1];
      getViews();
      function updatePage() {
        location.href = `?id=${video_id}`;
      }
      async function getViews() {
        let request = await fetch(
          `https://mixerno.space/api/yt/video/${video_id}`,
          { mode: "cors" }
        );
        let data = await request.json().catch(() => {});

        if (!data.errors) {
          // console.log(data);
          // Миниатюра видео
          //document.getElementById("YTthnail").src = data.items[0].snippet.thumbnails.maxres.url;
          // Название трансляции
          title.innerHTML = data.items[0].snippet.title;
          // Зрителей
          viewersCount.innerHTML =
            data.items[0].liveStreamingDetails.concurrentViewers;
          // Описание
          description.innerHTML = urlify(data.items[0].snippet.description);
          // Время начала трансляции
          actualStartTime.innerHTML = new Date(
            data.items[0].liveStreamingDetails.actualStartTime
          ).toLocaleString();
          // Трансляция запланирована
          scheduledStartTime.innerHTML = new Date(
            data.items[0].liveStreamingDetails.scheduledStartTime
          ).toLocaleString();
          // Публикация
          publishedAt.innerHTML = new Date(
            data.items[0].snippet.publishedAt
          ).toLocaleString();
          // Просмотров всего
          viewCount.innerHTML = data.items[0].statistics.viewCount;
          // Лайков
          likesCount.innerHTML = data.items[0].statistics.likeCount;
          // Дизлайков
          dislikeCount.innerHTML =
            data.items[0].statistics.dislikeCount;


            document.title = data.items[0].snippet.title;
          /*

          Percent Likes

          */
          var like = data.items[0].statistics.likeCount;
          var dislike = data.items[0].statistics.dislikeCount;
          document.getElementById("likeProgress").value = Math.round(100 * like / (+like+ + +dislike));

          /*
          
          Get Channel ID
          
          */
          // Channel ID
          var channelID = data.items[0].snippet.channelId;

          /*

          Start Channel Info 

          */
          fetch(
            `https://beta.mixerno.space/api/youtube-subscriber-counter/channel/` +
              channelID
          )
            .then((res) => res.json())
            .then((out) => {
              // console.log(out);
              // Имя канала
              CHchannelName.innerHTML = out.userList[0].user.name;
              // Кол-во подписчиков на канале
              CHsubscribersCountAPI.innerHTML =
                out.userList[0].stats.subscriberCountAPI.replace(
              /(\d)(?=(\d\d\d)+([^\d]|$))/g,
              "$1 "
            );
              // Кол-во видео на канале
              CHvideoCount.innerHTML = out.userList[0].stats.videoCount;
              // Просмотров на канале
              CHviewCount.innerHTML = out.userList[0].stats.viewCount;
              // Аватар канала
              document.getElementById("CHavatar").src =
                out.userList[0].user.avatar.high.url;
            })
            .catch((err) => {
              throw err;
            });
        }
      }
      function urlify(text) {
        var urlRegex = /(((https?:\/\/)|(www\.))[^\s]+)/g;
        //var urlRegex = /(https?:\/\/[^\s]+)/g;
        return text.replace(urlRegex, function (url, b, c) {
          var url2 = c == "www." ? "http://" + url : url;
          return '<a href="' + url2 + '" target="_blank">' + url + "</a>";
        });
      }
      setInterval(getViews, 10000);
    </script>
  </body>
</html>
